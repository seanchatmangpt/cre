{erl_opts, [debug_info, bin_opt_info,
              {platform_define, "^[0-9]+", 'OTP_25_PLUS'},
              {doc, "excerpt"},  % Enable documentation storage for doctests
              {src_dirs, ["src",
                          "src/core",
                          "src/pnet",
                          "src/wf",
                          "src/yawl",
                          "src/patterns",
                          "src/api",
                          "src/integration",
                          "src/http",
                          "src/app"]}]}.

%% Project version for CRE 0.2.0
%% Minimum OTP version: 25.0
%% Tested on: OTP 25, 26, 27, 28

{deps, [
        {gen_pnet, {git, "https://github.com/joergen7/gen_pnet.git", {branch, "master"}}},
        {lib_combin, {git, "https://github.com/joergen7/lib_combin.git", {ref, "953273d875ce4eb4119219bb0d1855acc258586c"}}},
        {cowboy, {git, "https://github.com/ninenines/cowboy.git", {tag, "2.14.2"}}},
        {cowlib, {git, "https://github.com/ninenines/cowlib.git", {tag, "2.16.0"}}},
        {ranch, {git, "https://github.com/ninenines/ranch.git", {tag, "2.1.0"}}},
        {jsx, {git, "https://github.com/talentdeficit/jsx.git", {tag, "v3.1.0"}}},
        {jsone, {git, "https://github.com/sile/jsone.git", {tag, "1.9.0"}}}
]}.  % Git deps for OTP 28 compat: cowboy 2.14.2, cowlib 2.16.0, ranch 2.1.0, jsx v3.1.0, jsone 1.9.0

{project_plugins, []}.  % Disable hex plugin to prevent git deps being overridden by hex packages

%% OTP 28 compat: override cowboy's cowlib dep to 2.16.0 (fixes unbound type variable error)
{overrides, [
    {override, cowboy, [
        {deps, [
            {cowlib, {git, "https://github.com/ninenines/cowlib.git", {tag, "2.16.0"}}},
            {ranch, {git, "https://github.com/ninenines/ranch.git", {tag, "2.1.0"}}}
        ]}
    ]}
]}.

{escript_incl_apps, [lib_combin, jsone]}.
{escript_emu_args, "%%! -connect_all false -sname cre\n"}.
{escript_name, "cre"}.

{profiles,
 [{test, [{cover_enabled, false},
          {erl_opts, [debug_info, {doc, "excerpt"}, {d, 'TEST'}, {i, "src/wf"}]},
          {deps, [{meck, "0.9.2"}]}]}]}.

%% Workaround: erlc rename race when ebin doesn't exist yet.
{pre_hooks, [{"(linux|darwin|solaris|.*)", compile, "mkdir -p _build/test/lib/cre/ebin _build/default/lib/cre/ebin 2>/dev/null; true"}]}.

{eunit_tests, [{application, cre}]}.
{eunit_opts, [no_tty]}.

{dialyzer, [{warnings, [unmatched_returns,
                        error_handling,
                        underspecs]},
            {plt_extra_apps, [lib_combin, gen_pnet, jsone, xmerl]},
            {get_warnings, true},
            {include_dirs, ["include"]},
            {exclude_apps, []}]}.
