{erl_opts, [debug_info, bin_opt_info,
              {platform_define, "^[0-9]+", 'OTP_25_PLUS'},
              {doc, "excerpt"},  % Enable documentation storage for doctests
              {src_dirs, ["src",
                          "src/core",
                          "src/pnet",
                          "src/wf",
                          "src/yawl",
                          "src/patterns",
                          "src/api",
                          "src/integration",
                          "src/http",
                          "src/app"]}]}.

%% Project version for CRE 0.3.0
%% Minimum OTP version: 25.0
%% Tested on: OTP 25, 26, 27, 28

{deps, [
        {cowboy, "2.12.0"},
        {cowlib, "2.12.0"},
        {ranch, "1.8.0"},
        {jsx, "3.1.0"},
        {jsone, "1.9.0"},
        {poolboy, "1.5.2"},
        {doctest, "0.13.1"},
        {lib_combin, {git, "https://github.com/joergen7/lib_combin.git", {ref, "953273d875ce4eb4119219bb0d1855acc258586c"}}}]}.  % Using local gen_pnet in src/core/

{escript_incl_apps, [lib_combin, jsone]}.  % gen_pnet is compiled as part of cre
{escript_emu_args, "%%! -connect_all false -sname cre\n"}.
{escript_name, "cre"}.

{profiles,
 [{test, [{cover_enabled, false},
          {erl_opts, [debug_info, {doc, "excerpt"}, {d, 'TEST'}, {i, "src/wf"}]}]}]}.

%% Workaround: erlc rename race when ebin doesn't exist yet.
{pre_hooks, [{"(linux|darwin|solaris|.*)", compile, "mkdir -p _build/test/lib/cre/ebin _build/default/lib/cre/ebin 2>/dev/null; true"}]}.

{eunit_tests, [{application, cre}]}.
{eunit_opts, [no_tty, {report, {doctest_eunit_report, []}}]}.

{dialyzer, [{warnings, [unmatched_returns,
                        error_handling,
                        underspecs]},
            {plt_extra_apps, [lib_combin, gen_pnet, jsone, xmerl]},
            {get_warnings, true},
            {include_dirs, ["include"]},
            {exclude_apps, []}]}.